<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="دليل السائق للمناطق ذات الطلب العالي في عمان - تطبيق لمساعدة السائقين على إيجاد المناطق ذات الطلب العالي">
    <meta name="theme-color" content="#4361ee">
    <title>دليل السائق للمناطق ذات الطلب العالي - عمان</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.0.2/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container-fluid p-0 driver-container">
        <!-- Driver-Optimized Header -->
        <header class="driver-header bg-white shadow-sm">
            <div class="container-fluid">
                <div class="row align-items-center mb-2">
                    <div class="col">
                        <h1 class="h4 mb-0 text-primary fw-bold">
                            <i class="bi bi-car-front me-2"></i>دليل السائق
                        </h1>
                    </div>
                    <div class="col-auto">
                        <div class="btn-group me-2" role="group">
                            <button id="voice-toggle" class="btn btn-success btn-sm rounded-circle" style="width: 48px; height: 48px;">
                                <i class="bi bi-volume-up"></i>
                            </button>
                            <button id="share-location" class="btn btn-info btn-sm rounded-circle ms-1" style="width: 48px; height: 48px;">
                                <i class="bi bi-share"></i>
                            </button>
                            <button id="emergency-btn" class="btn btn-danger btn-sm rounded-circle ms-1" style="width: 48px; height: 48px;">
                                <i class="bi bi-exclamation-triangle"></i>
                            </button>
                        </div>
                        <button id="view-toggle" class="btn btn-primary btn-sm rounded-circle" style="width: 48px; height: 48px;">
                            <i class="bi bi-map"></i>
                        </button>
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col">
                        <div class="d-flex align-items-center bg-light rounded p-2">
                            <i class="bi bi-geo-alt text-primary me-2"></i>
                            <span id="current-area-display" class="fw-semibold">جاري التحديد...</span>
                        </div>
                    </div>
                    <div class="col">
                        <div class="d-flex align-items-center bg-light rounded p-2">
                            <i class="bi bi-clock text-warning me-2"></i>
                            <span id="demand-mode-display" class="fw-semibold">جاري التحميل...</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Driver Dashboard -->
        <div class="driver-dashboard p-3">
            <!-- Location Display Mode -->
            <div class="card location-display-card d-none" id="location-display-card">
                <div class="card-body">
                    <div class="row align-items-center mb-3">
                        <div class="col-auto">
                            <div class="location-icon text-primary" style="font-size: 3rem;">
                                <i class="bi bi-geo-alt-fill"></i>
                            </div>
                        </div>
                        <div class="col">
                            <h5 id="current-location-name" class="card-title mb-1">جاري تحديد الموقع...</h5>
                            <div class="d-flex gap-3 text-muted">
                                <span id="accuracy-info"><i class="bi bi-bullseye me-1"></i>--</span>
                                <span id="speed-info"><i class="bi bi-speedometer me-1"></i>--</span>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-primary d-flex align-items-center" role="alert">
                        <div id="direction-icon" class="me-3" style="font-size: 2rem;">
                            <i class="bi bi-arrow-right"></i>
                        </div>
                        <div id="direction-text" class="fw-semibold">استمر في الطريق الحالي</div>
                    </div>
                </div>
            </div>

            <!-- Primary Action Card -->
            <div class="card primary-card border-primary">
                <div class="card-header bg-primary text-white">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5 class="mb-0"><i class="bi bi-bullseye me-2"></i>المنطقة المقترحة</h5>
                        </div>
                        <div class="col-auto">
                            <div id="demand-indicator" class="badge bg-success rounded-circle p-3" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                                <span id="demand-level" class="fw-bold">--</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h4 id="suggested-zone-display" class="card-title text-primary">جاري البحث...</h4>
                    <div class="row text-muted mb-3">
                        <div class="col">
                            <i class="bi bi-geo me-1"></i>
                            <span id="suggested-distance">--</span>
                        </div>
                        <div class="col">
                            <i class="bi bi-clock me-1"></i>
                            <span id="suggested-eta">--</span>
                        </div>
                    </div>
                    <div class="row g-2">
                        <div class="col">
                            <button id="navigate-btn" class="btn btn-primary w-100" disabled>
                                <i class="bi bi-navigation me-2"></i>توجه الآن
                            </button>
                        </div>
                        <div class="col-auto">
                            <button id="refresh-suggestion" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row g-2 mt-2">
                <div class="col-6 col-md-3">
                    <button id="find-nearest" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 60px;">
                        <i class="bi bi-geo-alt mb-1"></i>
                        <small>أقرب منطقة</small>
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button id="high-demand-filter" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center toggle-btn" style="min-height: 60px;">
                        <i class="bi bi-fire mb-1"></i>
                        <small>طلب عالي فقط</small>
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button id="voice-navigation" class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 60px;">
                        <i class="bi bi-mic mb-1"></i>
                        <small>التوجيه الصوتي</small>
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button id="safety-mode" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center toggle-btn" style="min-height: 60px;">
                        <i class="bi bi-shield-check mb-1"></i>
                        <small>وضع الأمان</small>
                    </button>
                </div>
            </div>
        </div>

        <!-- Map Container -->
        <div id="map" class="driver-map flex-grow-1"></div>

        <!-- Bottom Panel -->
        <div class="bottom-panel bg-white">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="bottomTabs" role="tablist">
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link active w-100" id="zones-tab" data-bs-toggle="tab" data-bs-target="#zones" type="button" role="tab">
                        <i class="bi bi-geo-alt me-1"></i>المناطق
                    </button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link w-100" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                        <i class="bi bi-gear me-1"></i>الإعدادات
                    </button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link w-100" id="debug-tab" data-bs-toggle="tab" data-bs-target="#debug" type="button" role="tab">
                        <i class="bi bi-bug me-1"></i>التشخيص
                    </button>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content p-3" style="height: 250px; overflow-y: auto;">
                <!-- Zones Tab -->
                <div class="tab-pane fade show active" id="zones" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">المناطق المتاحة</h5>
                        <select id="zone-sort" class="form-select form-select-sm" style="width: auto;">
                            <option value="demand">حسب الطلب</option>
                            <option value="distance">حسب المسافة</option>
                            <option value="name">حسب الاسم</option>
                        </select>
                    </div>
                    <div id="zones-grid" class="row g-2"></div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings" role="tabpanel">
                    <div class="accordion" id="settingsAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#audioSettings">
                                    <i class="bi bi-volume-up me-2"></i>إعدادات الصوت
                                </button>
                            </h2>
                            <div id="audioSettings" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="voice-enabled" checked>
                                        <label class="form-check-label" for="voice-enabled">تفعيل التنبيهات الصوتية</label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="voice-volume" class="form-label">مستوى الصوت</label>
                                        <input type="range" class="form-range" id="voice-volume" min="0" max="100" value="70">
                                    </div>
                                    <div class="mb-3">
                                        <label for="voice-language" class="form-label">لغة التنبيهات</label>
                                        <select id="voice-language" class="form-select">
                                            <option value="ar">العربية</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#drivingSettings">
                                    <i class="bi bi-car-front me-2"></i>إعدادات القيادة
                                </button>
                            </h2>
                            <div id="drivingSettings" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="safety-mode-setting">
                                        <label class="form-check-label" for="safety-mode-setting">وضع الأمان</label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="auto-refresh" checked>
                                        <label class="form-check-label" for="auto-refresh">التحديث التلقائي</label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="map-style-setting" class="form-label">نمط الخريطة</label>
                                        <select id="map-style-setting" class="form-select">
                                            <option value="osm">عادي</option>
                                            <option value="satellite">قمر صناعي</option>
                                            <option value="dark">داكن</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#displaySettings">
                                    <i class="bi bi-display me-2"></i>إعدادات العرض
                                </button>
                            </h2>
                            <div id="displaySettings" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="auto-switch-text">
                                        <label class="form-check-label" for="auto-switch-text">التبديل التلقائي للنص أثناء القيادة</label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="text-mode-speed" class="form-label">سرعة التبديل التلقائي (<span id="speed-display">30</span> كم/س)</label>
                                        <input type="range" class="form-range" id="text-mode-speed" min="20" max="60" value="30">
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enhanced-voice-text" checked>
                                        <label class="form-check-label" for="enhanced-voice-text">تعليمات صوتية محسنة في وضع النص</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debug Tab -->
                <div class="tab-pane fade" id="debug" role="tabpanel">
                    <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>معلومات النظام</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <small class="text-muted">حالة التطبيق</small>
                                    <div id="app-state" class="fw-bold">تهيئة</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <small class="text-muted">حالة الموقع</small>
                                    <div id="location-state" class="fw-bold">غير محدد</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <small class="text-muted">دقة الموقع</small>
                                    <div id="location-accuracy" class="fw-bold">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light">
                                <div class="card-body p-2">
                                    <small class="text-muted">عدد المناطق</small>
                                    <div id="zones-count" class="fw-bold">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <button id="test-voice" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-mic me-1"></i>اختبار الصوت
                        </button>
                        <button id="force-reload" class="btn btn-outline-warning btn-sm">
                            <i class="bi bi-arrow-clockwise me-1"></i>إعادة تحميل
                        </button>
                        <button id="export-logs" class="btn btn-outline-info btn-sm">
                            <i class="bi bi-download me-1"></i>تصدير السجلات
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rest of the modals and elements remain the same but with Bootstrap classes -->
        <!-- Audio Elements -->
        <audio id="notification-sound" preload="auto">
            <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
        </audio>

        <!-- Voice Alerts Container -->
        <div id="voice-alerts" class="position-fixed top-50 start-50 translate-middle bg-dark text-white p-4 rounded-3 text-center" style="z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;"></div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-white bg-opacity-95" style="z-index: 9999; backdrop-filter: blur(5px);">
            <div class="text-center">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <div class="loading-text h5">جاري تحميل التطبيق...</div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container position-fixed bottom-0 start-50 translate-middle-x p-3">
            <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-body text-center fw-semibold"></div>
            </div>
        </div>

        <!-- Share Location Modal -->
        <div id="share-modal" class="share-modal">
            <div class="share-modal-content">
                <div class="share-header">
                    <h3>مشاركة الموقع</h3>
                    <button id="close-share-modal" class="close-btn">✕</button>
                </div>
                
                <div class="share-tabs">
                    <button class="share-tab-btn active" data-tab="quick">مشاركة سريعة</button>
                    <button class="share-tab-btn" data-tab="contacts">جهات الاتصال</button>
                    <button class="share-tab-btn" data-tab="live">تتبع مباشر</button>
                </div>

                <!-- Quick Share Tab -->
                <div class="share-tab-content active" id="quick-share-tab">
                    <div class="location-preview">
                        <div class="preview-icon">📍</div>
                        <div class="preview-info">
                            <div class="preview-title" id="share-location-name">الموقع الحالي</div>
                            <div class="preview-details" id="share-location-details">جاري تحديد الموقع...</div>
                        </div>
                    </div>
                    
                    <div class="share-options">
                        <button id="share-whatsapp" class="share-option-btn whatsapp">
                            <span class="share-icon">💬</span>
                            <span class="share-text">WhatsApp</span>
                        </button>
                        <button id="share-telegram" class="share-option-btn telegram">
                            <span class="share-icon">✈️</span>
                            <span class="share-text">Telegram</span>
                        </button>
                        <button id="share-sms" class="share-option-btn sms">
                            <span class="share-icon">💬</span>
                            <span class="share-text">رسالة نصية</span>
                        </button>
                        <button id="share-copy" class="share-option-btn copy">
                            <span class="share-icon">📋</span>
                            <span class="share-text">نسخ الرابط</span>
                        </button>
                        <button id="share-email" class="share-option-btn email">
                            <span class="share-icon">📧</span>
                            <span class="share-text">بريد إلكتروني</span>
                        </button>
                        <button id="share-maps" class="share-option-btn maps">
                            <span class="share-icon">🗺️</span>
                            <span class="share-text">خرائط جوجل</span>
                        </button>
                    </div>
                </div>

                <!-- Contacts Tab -->
                <div class="share-tab-content" id="contacts-share-tab">
                    <div class="contacts-header">
                        <input type="text" id="contact-search" placeholder="البحث في جهات الاتصال..." class="contact-search">
                        <button id="add-contact" class="add-contact-btn">+ إضافة جهة اتصال</button>
                    </div>
                    <div id="favorite-contacts" class="favorite-contacts"></div>
                </div>

                <!-- Live Tracking Tab -->
                <div class="share-tab-content" id="live-share-tab">
                    <div class="live-tracking-info">
                        <div class="live-icon">📡</div>
                        <h4>التتبع المباشر</h4>
                        <p>مشاركة موقعك المباشر مع الآخرين لفترة محددة</p>
                    </div>
                    
                    <div class="live-options">
                        <div class="duration-selector">
                            <label>مدة المشاركة:</label>
                            <select id="share-duration">
                                <option value="15">15 دقيقة</option>
                                <option value="30" selected>30 دقيقة</option>
                                <option value="60">ساعة واحدة</option>
                                <option value="120">ساعتان</option>
                                <option value="480">8 ساعات</option>
                            </select>
                        </div>
                        
                        <div class="privacy-options">
                            <label>
                                <input type="checkbox" id="include-destination" checked>
                                تضمين الوجهة المقترحة
                            </label>
                            <label>
                                <input type="checkbox" id="show-route">
                                عرض المسار المتبع
                            </label>
                        </div>
                        
                        <button id="start-live-share" class="start-live-btn">بدء المشاركة المباشرة</button>
                    </div>
                    
                    <div id="active-shares" class="active-shares"></div>
                </div>
            </div>
        </div>

        <!-- Add Contact Modal -->
        <div id="add-contact-modal" class="add-contact-modal">
            <div class="add-contact-content">
                <div class="add-contact-header">
                    <h3>إضافة جهة اتصال</h3>
                    <button id="close-add-contact" class="close-btn">✕</button>
                </div>
                <form id="add-contact-form">
                    <div class="form-group">
                        <label for="contact-name">الاسم:</label>
                        <input type="text" id="contact-name" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-phone">رقم الهاتف:</label>
                        <input type="tel" id="contact-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-type">النوع:</label>
                        <select id="contact-type">
                            <option value="customer">عميل</option>
                            <option value="family">عائلة</option>
                            <option value="friend">صديق</option>
                            <option value="work">عمل</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="save-contact-btn">حفظ</button>
                        <button type="button" id="cancel-add-contact" class="cancel-btn">إلغاء</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/maplibre-gl@4.0.2/dist/maplibre-gl.js"></script>
    <script src="app.js"></script>
</body>
</html>
